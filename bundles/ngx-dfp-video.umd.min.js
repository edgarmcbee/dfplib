!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@alugha/ima")):"function"==typeof define&&define.amd?define("ngx-dfp/video",["exports","@angular/core","@angular/common","@alugha/ima"],t):t(((e=e||self)["ngx-dfp"]=e["ngx-dfp"]||{},e["ngx-dfp"].video={}),e.ng.core,e.ng.common,e.ima)}(this,(function(e,t,n,o){"use strict";var i=function(){function e(){this.generatedIDs={}}return e.prototype.generateID=function(e){void 0===e&&(e="dfp-ad");var t=null;do{t=e+"-"+Math.random().toString().slice(2)}while(t in this.generatedIDs);return this.generatedIDs[t]=!0,t},e.prototype.dfpIDGenerator=function(e){if(e&&e.id&&!(e.id in this.generatedIDs))return e.id;var t=this.generateID(e.tagName.toLowerCase());return e&&(e.id=t),t},e.prototype.isTaken=function(e){return e in this.generatedIDs},e.prototype.isUnique=function(e){return!this.isTaken(e)},e.decorators=[{type:t.Injectable}],e}();var r=function(){function e(e,n,o,i){this.platformId=e,this.elementRef=n,this.renderer=o,this.dfpIDGenerator=i,this.adEvents=new t.EventEmitter,this.adsDone=!1}return e.prototype.ngOnInit=function(){var e=this;if(n.isPlatformBrowser(this.platformId)){var t=this.elementRef.nativeElement;this.dfpIDGenerator.dfpIDGenerator(t),this.contentPlayer=t.querySelector("video"),this.renderer.setAttribute(this.contentPlayer,"width",this.width.toString()),this.renderer.setAttribute(this.contentPlayer,"height",this.height.toString()),this.adContainer=t.querySelector(".ad-container"),this.adContainer||(this.adContainer=this.renderer.createElement("div"),this.renderer.addClass(this.adContainer,"ad-container"),this.renderer.appendChild(t,this.adContainer)),o.loadImaSdk().then((function(){return e.setUpIMA()})),this.adActions.subscribe((function(t){switch(t){case"play":e.play();break;case"pause":e.pause();break;case"resume":e.resume()}}))}},e.prototype.play=function(){this.adsDone||(this.initialUserAction(),this.loadAds(),this.adsDone=!0)},e.prototype.pause=function(){this.adsManager&&this.adsManager.pause()},e.prototype.resume=function(){this.adsManager&&this.adsManager.resume()},e.prototype.setUpIMA=function(){var e=this;this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.contentPlayer),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(function(t){return e.onAdsManagerLoaded(t)}),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(function(t){return e.onAdError(t)}),!1),this.contentPlayer.onended=function(){e.contentEnded()}},e.prototype.initialUserAction=function(){this.adDisplayContainer.initialize(),this.contentPlayer.load()},e.prototype.requestAds=function(e){var t=new google.ima.AdsRequest;t.adTagUrl=e,t.linearAdSlotWidth=this.width,t.linearAdSlotHeight=this.height,t.nonLinearAdSlotWidth=this.width,t.nonLinearAdSlotHeight=this.height,this.adsLoader.requestAds(t)},e.prototype.contentEnded=function(){this.contentCompleteCalled=!0,this.adsLoader.contentComplete()},e.prototype.onAdsManagerLoaded=function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=e.getAdsManager(this.contentPlayer,t),this.startAdsManager(this.adsManager)},e.prototype.startAdsManager=function(e){var t=this;e.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,(function(){return t.onContentPauseRequested()}),!1,this),e.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,(function(){return t.onContentResumeRequested()}),!1,this),e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(function(e){return t.onAdError(e)}),!1,this),[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.THIRD_QUARTILE].forEach((function(n){return e.addEventListener(n,(function(e){return t.onAdEvent(e)}),!1)})),e.init(this.width,this.height,google.ima.ViewMode.NORMAL),e.start()},e.prototype.onContentPauseRequested=function(){this.pauseForAd()},e.prototype.onContentResumeRequested=function(){this.contentCompleteCalled||this.resumeAfterAd()},e.prototype.onAdEvent=function(e){e.type===google.ima.AdEvent.Type.LOADED&&(e.getAd().isLinear()||this.onContentResumeRequested());this.adEvents.emit(e)},e.prototype.onAdError=function(e){this.adsManager&&this.adsManager.destroy(),this.resumeAfterAd(),this.adEvents.emit(e)},e.prototype.resumeAfterAd=function(){this.contentPlayer.play()},e.prototype.pauseForAd=function(){this.contentPlayer.pause()},e.prototype.loadAds=function(){this.requestAds(this.adTag)},e.decorators=[{type:t.Directive,args:[{selector:"dfp-video"}]}],e.ctorParameters=function(){return[{type:Object,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:t.ElementRef},{type:t.Renderer2},{type:i}]},e.propDecorators={width:[{type:t.Input}],height:[{type:t.Input}],adTag:[{type:t.Input}],adActions:[{type:t.Input}],adEvents:[{type:t.Output}]},e}();var a=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[r],exports:[r],providers:[i]}]}],e}();e.DfpVideoDirective=r,e.DfpVideoModule=a,e.Éµa=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-dfp-video.umd.min.js.map